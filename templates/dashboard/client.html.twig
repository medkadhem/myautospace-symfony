{% extends 'base.html.twig' %}

{% block title %}Client Dashboard - MyAutoSpace{% endblock %}

{% block body %}
<div class="dashboard-container">
  <div class="dashboard-header">
    <div>
      <h1>Client Dashboard</h1>
      <p style="color: var(--muted); margin: 8px 0 0;">Browse, book, and manage your reservations</p>
    </div>
    <div class="dashboard-header-actions">
      <a href="{{ path('app_default') }}" class="btn yellow btn-lg">+ Browse Marketplace</a>
    </div>
  </div>

  <div class="dashboard-stats">
    <div class="stat-card">
      <div class="stat-icon">üöó</div>
      <div class="stat-label">Active Bookings</div>
      <div class="stat-value">{{ activeReservations }}</div>
      <div class="stat-change">Confirmed</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-label">Completed</div>
      <div class="stat-value">{{ completedReservations }}</div>
      <div class="stat-change">Finished bookings</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">üìä</div>
      <div class="stat-label">Total Reservations</div>
      <div class="stat-value">{{ totalReservations }}</div>
      <div class="stat-change">All time</div>
    </div>
  </div>

  <div class="dashboard-grid">
    <div class="dashboard-card">
      <span class="card-icon">üè™</span>
      <h3>Browse Marketplace</h3>
      <p>Discover cars and services from providers</p>
      <a href="{{ path('app_default') }}" class="btn yellow btn-block">Go to Marketplace</a>
    </div>

    <div class="dashboard-card">
      <span class="card-icon">üìã</span>
      <h3>My Bookings</h3>
      <p>Track your reservations and confirmations</p>
      <a href="{{ path('app_reservation_index') }}" class="btn secondary btn-block">View Bookings</a>
    </div>

    <div class="dashboard-card">
      <span class="card-icon">‚ù§Ô∏è</span>
      <h3>Saved Favorites</h3>
      <p>Your bookmarked cars and services</p>
      <a href="{{ path('app_marketplace') }}" class="btn secondary btn-block">View Favorites</a>
    </div>

    <div class="dashboard-card">
      <span class="card-icon">‚≠ê</span>
      <h3>My Reviews</h3>
      <p>Leave and manage your reviews</p>
      <a href="{{ path('app_review_index') }}" class="btn secondary btn-block">My Reviews</a>
    </div>
  </div>

  {% if recentReservations|length > 0 %}
  <div class="dashboard-section">
    <h2>Your Recent Bookings</h2>
    <div class="dashboard-table-wrapper">
      <table class="table">
        <thead>
          <tr>
            <th>Car/Service</th>
            <th>Provider</th>
            <th>Booking Date</th>
            <th>Status</th>
            <th>Amount</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for reservation in recentReservations %}
          <tr>
            <td>
              <strong>
                {% if reservation.announcement %}
                  {{ reservation.announcement.title }}
                {% elseif reservation.service %}
                  {{ reservation.service.title }}
                {% else %}
                  Unknown
                {% endif %}
              </strong>
            </td>
            <td>
              {% if reservation.announcement and reservation.announcement.vendor %}
                {{ reservation.announcement.vendor.fullName ? reservation.announcement.vendor.fullName : reservation.announcement.vendor.email }}
              {% elseif reservation.service and reservation.service.provider %}
                {{ reservation.service.provider.fullName ? reservation.service.provider.fullName : reservation.service.provider.email }}
              {% else %}
                Unknown
              {% endif %}
            </td>
            <td>{{ reservation.createdAt|date('d M Y') }}</td>
            <td>
              {% if reservation.status == 'confirmed' %}
                <span class="badge success">Confirmed</span>
              {% elseif reservation.status == 'pending' %}
                <span class="badge warning">Pending</span>
              {% elseif reservation.status == 'completed' %}
                <span class="badge info">Completed</span>
              {% else %}
                <span class="badge">{{ reservation.status|capitalize }}</span>
              {% endif %}
            </td>
            <td>{{ reservation.price ? (reservation.price|number_format(0, '.', ' ')) : 'N/A' }} TND</td>
            <td>
              <a href="{{ path('app_reservation_show', {id: reservation.id}) }}" class="btn btn-sm secondary">View</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% else %}
  <div class="dashboard-section" style="text-align: center; padding: 60px 20px;">
    <p style="color: var(--muted); font-size: 16px; margin-bottom: 20px;">üì≠ You haven't made any bookings yet</p>
    <a href="{{ path('app_default') }}" class="btn yellow btn-lg">Browse Marketplace</a>
  </div>
  {% endif %}
</div>
{% endblock %}
